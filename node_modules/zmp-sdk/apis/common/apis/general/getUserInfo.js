import e from'./../../../external/@swc/helpers/src/_async_to_generator.mjs.js';import n from"../../token.js";import{APIS as t,APP_ID as s}from"../../../constants.js";import{canUseAccessTokenByDefault as i}from"../../../utils/common.js";import{__generator as o}from'./../../../external/tslib/tslib.es6.js';var r,c=(r=e((function(r,c){var a,l,u,d;return o(this,(function(m){switch(m.label){case 0:return(l=c)?[3,2]:[4,i()];case 1:l=!m.sent(),m.label=2;case 2:return a=l,[4,n.getAccessToken(a)];case 3:return u=m.sent(),d="id,name,user_id_by_oa,is_sensitive",d=r?"".concat(d,",picture.type(").concat(r,")"):"".concat(d,",picture"),[4,fetch("".concat(t.GET_USER_INFO,"?fields=").concat(d,"&miniapp_id=").concat(s),{headers:{access_token:u||""}}).then(function(){var n=e((function(e){var n,t,s,i;return o(this,(function(o){switch(o.label){case 0:return[4,e.json()];case 1:return s=o.sent(),i=null==s?void 0:s.user_id_by_oa,[2,{id:null==s?void 0:s.id,name:(null==s?void 0:s.name)||"",avatar:(null==s||null===(n=s.picture)||void 0===n||null===(t=n.data)||void 0===t?void 0:t.url)||"",idByOA:i,followedOA:!!(null==s?void 0:s.is_follower),isSensitive:null==s?void 0:s.is_sensitive}]}}))}));return function(e){return n.apply(this,arguments)}}())];case 4:return[2,m.sent()]}}))})),function(e,n){return r.apply(this,arguments)});export{c as default};
