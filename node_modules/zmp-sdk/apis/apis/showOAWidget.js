import e from'./../external/@swc/helpers/src/_async_to_generator.mjs.js';import o from'./../external/@swc/helpers/src/_object_without_properties.mjs.js';import t from'./../external/@swc/helpers/src/_sliced_to_array.mjs.js';import n,{object as r,string as i}from'./../external/zod/lib/index.mjs.js';import s from"../appEnv/index.js";import a from"../common/notFound.js";import{functionHandler as l}from"../utils/decorator.js";import m from"../common/token.js";import c from"../common/apis/general/openProfile.js";import{__generator as d}from'./../external/tslib/tslib.es6.js';var u=[r({id:i(),guidingText:i().optional(),color:i().optional(),onStatusChange:n.function().optional()})];function p(e){return h.apply(this,arguments)}function h(){return h=e((function(n){return d(this,(function(r){return[2,l("showOAWidget",u,[n],(i=e((function(n){var r,i,l,u,p,h,f,g;return d(this,(function(j){if(s.isMp){try{r=document.getElementById(n.id),i=n.onStatusChange,l=n.guidingText,u=n.color,p=o(n,["onStatusChange","guidingText","color"]),r&&(h=document.createElement("iframe"),f="iframeOAWidget_".concat(Date.now()),(g=new URL("https://h5.zalo.me/widgets/oa_widget.html")).searchParams.set("id",f),l&&g.searchParams.set("guidingText",l),u&&g.searchParams.set("color",u),Object.entries(p).forEach((function(e){var o=t(e,2),n=o[0],r=o[1];r&&g.searchParams.set("data-".concat(n),String(r))})),h.id=f,h.src=g.href,h.style.width="100%",h.style.height="100%",h.style.border="none",r.innerHTML=h.outerHTML,window.addEventListener("message",function(){var o=e((function(e){var o,t,n,r,s,a,l,u;return d(this,(function(d){switch(d.label){case 0:return o=e.data,e.origin.startsWith("https://h5.zalo.me")?(t=document.getElementById(f),n=o.type,(r=new URL(o.href)).origin!==g.origin||r.pathname!==g.pathname||o.id!==f?[3,3]:"followOA"!==n&&"getOAInfo"!==n?[3,2]:[4,m.jumpAndGetToken()]):[3,3];case 1:return d.sent(),l=null===(s=m.miniProgramConfig)||void 0===s?void 0:s.jwt,null==t||null===(a=t.contentWindow)||void 0===a||a.postMessage({type:n,payload:{jwt:l}},"*"),[3,3];case 2:"oaInfo"===n?null==i||i(null===(u=o.payload)||void 0===u?void 0:u.followed):"openOA"===n?c(o.payload.id,"oa"):"heightChange"===n&&(t.style.height="".concat(o.payload,"px")),d.label=3;case 3:return[2]}}))}));return function(e){return o.apply(this,arguments)}}(),!1))}catch(e){console.log(e)}return[2,Promise.resolve()]}return s.isMpWeb?[2,Promise.resolve()]:[2,Promise.reject(a("openMiniApp",{}))]}))})),function(e){return i.apply(this,arguments)}))];var i}))})),h.apply(this,arguments)}export{p as showOAWidget};
